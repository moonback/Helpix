import{u as B,f as E,a as A,r as c,j as e}from"./index-CjebVJkO.js";import{u as P}from"./taskStore-MOUmrc_1.js";import{B as h,m as z}from"./Button-DEGNrHwP.js";import{C as x}from"./Card-jpH0K7U9.js";import{I as o}from"./Input-DqtLaMe4.js";import{A as L,L as M,T as F}from"./LocationMap-C2D_kJzj.js";import{A as O}from"./arrow-left-DkBG_r8s.js";import{C as R,T as U}from"./target-BSz0SWKc.js";import{D as $}from"./navigation-9Pw6fzxm.js";import{C as G}from"./calendar-X3IWeBnO.js";import{T as H}from"./trash-2-effVLLmh.js";import"./utils-CKFTCDAY.js";import"./search-B2S3MmgA.js";import"./x-ChkrsoWQ.js";import"./map-pin-CgGH4UHL.js";import"./index-D8iRmFxm.js";const ne=()=>{const u=B(),{taskId:g}=E(),{tasks:p,updateTask:_,deleteTask:S,isLoading:C}=P(),{user:m}=A(),[t,i]=c.useState({title:"",description:"",category:"local",priority:"medium",estimated_duration:"",location:"",required_skills:"",budget_credits:"",deadline:"",tags:""}),[s,f]=c.useState(null),[b,y]=c.useState(!1),[v,j]=c.useState(!1),[n,k]=c.useState(null);c.useEffect(()=>{var r,l,d,N;if(g&&p.length>0){const a=p.find(q=>q.id===parseInt(g));if(a){if(k(a),m&&a.user_id!==m.id){u("/");return}i({title:a.title||"",description:a.description||"",category:a.category||"local",priority:a.priority||"medium",estimated_duration:((r=a.estimated_duration)==null?void 0:r.toString())||"",location:a.location||"",required_skills:((l=a.required_skills)==null?void 0:l.join(", "))||"",budget_credits:((d=a.budget_credits)==null?void 0:d.toString())||"",deadline:a.deadline?new Date(a.deadline).toISOString().slice(0,16):"",tags:((N=a.tags)==null?void 0:N.join(", "))||""}),a.latitude&&a.longitude&&f({latitude:a.latitude,longitude:a.longitude})}}},[g,p,m,u]);const w=async r=>{if(r.preventDefault(),!(!m||!n)){y(!0);try{const l={...n,...t,estimated_duration:parseInt(t.estimated_duration),budget_credits:parseInt(t.budget_credits),required_skills:t.required_skills.split(",").map(d=>d.trim()).filter(Boolean),tags:t.tags.split(",").map(d=>d.trim()).filter(Boolean),deadline:t.deadline||void 0,latitude:s==null?void 0:s.latitude,longitude:s==null?void 0:s.longitude,updated_at:new Date().toISOString()};await _(n.id,l),u("/")}catch(l){console.error("Erreur lors de la modification de la t√¢che:",l)}finally{y(!1)}}},I=async()=>{if(!(!n||!confirm("√ätes-vous s√ªr de vouloir supprimer cette t√¢che ?"))){j(!0);try{await S(n.id),u("/")}catch(r){console.error("Erreur lors de la suppression de la t√¢che:",r)}finally{j(!1)}}},D={low:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"},T={low:"üü¢",medium:"üü°",high:"üü†",urgent:"üî¥"};return C||!n?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Chargement de la t√¢che..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-primary-100 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>u(-1),className:"p-2",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Modifier la T√¢che"}),e.jsx("div",{className:"w-10"})]})}),e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs(z.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},onSubmit:w,className:"space-y-4",children:[e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:"üìù Informations de base"}),e.jsx(o,{label:"Titre de la t√¢che",value:t.title,onChange:r=>i({...t,title:r.target.value}),placeholder:"Ex: Aide pour d√©m√©nagement",required:!0}),e.jsx(o,{label:"Description",value:t.description,onChange:r=>i({...t,description:r.target.value}),placeholder:"D√©crivez en d√©tail ce dont vous avez besoin...",required:!0,multiline:!0,rows:3}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cat√©gorie"}),e.jsxs("select",{value:t.category,onChange:r=>i({...t,category:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"local",children:"üìç Sur place"}),e.jsx("option",{value:"remote",children:"üíª √Ä distance"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priorit√©"}),e.jsxs("select",{value:t.priority,onChange:r=>i({...t,priority:r.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"low",children:"üü¢ Faible"}),e.jsx("option",{value:"medium",children:"üü° Moyenne"}),e.jsx("option",{value:"high",children:"üü† √âlev√©e"}),e.jsx("option",{value:"urgent",children:"üî¥ Urgente"})]})]})]})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:"üìç D√©tails et localisation"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{label:"Dur√©e estim√©e (heures)",type:"number",value:t.estimated_duration,onChange:r=>i({...t,estimated_duration:r.target.value}),placeholder:"2",required:!0,leftIcon:R}),e.jsx(o,{label:"Budget (cr√©dits)",type:"number",value:t.budget_credits,onChange:r=>i({...t,budget_credits:r.target.value}),placeholder:"50",required:!0,leftIcon:$})]}),e.jsx(L,{label:"Localisation",value:t.location,onChange:r=>i({...t,location:r}),onLocationSelect:(r,l)=>f({latitude:r,longitude:l}),placeholder:"Rechercher une adresse ou utiliser votre localisation actuelle",required:!0}),s&&e.jsx(M,{latitude:s.latitude,longitude:s.longitude,address:t.location,className:"mt-4"}),e.jsx(o,{label:"Comp√©tences requises",value:t.required_skills,onChange:r=>i({...t,required_skills:r.target.value}),placeholder:"Ex: Bricolage, Informatique, Langues (s√©par√©es par des virgules)",leftIcon:U}),e.jsx(o,{label:"Tags",value:t.tags,onChange:r=>i({...t,tags:r.target.value}),placeholder:"Ex: urgent, d√©m√©nagement, aide (s√©par√©s par des virgules)",leftIcon:F}),e.jsx(o,{label:"Date limite (optionnel)",type:"datetime-local",value:t.deadline,onChange:r=>i({...t,deadline:r.target.value}),leftIcon:G})]})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`p-2 rounded-full ${D[t.priority]}`,children:e.jsx("span",{className:"text-lg",children:T[t.priority]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Priorit√© ",t.priority.charAt(0).toUpperCase()+t.priority.slice(1)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.priority==="urgent"&&"Besoin imm√©diat",t.priority==="high"&&"Besoin important",t.priority==="medium"&&"Besoin mod√©r√©",t.priority==="low"&&"Pas urgent"]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{type:"submit",variant:"primary",size:"lg",loading:b,className:"flex-1",disabled:!t.title||!t.description||!t.estimated_duration||!t.budget_credits||t.category==="local"&&!s,children:b?"Modification...":"üíæ Sauvegarder"}),e.jsx(h,{type:"button",variant:"danger",size:"lg",onClick:I,loading:v,className:"px-6",children:v?"Suppression...":e.jsx(H,{className:"w-5 h-5"})})]}),t.category==="local"&&!s&&e.jsx("div",{className:"text-center text-sm text-amber-600 bg-amber-50 p-3 rounded-lg border border-amber-200",children:"üìç Pour les t√¢ches sur place, une localisation pr√©cise est requise"})]})})]})};export{ne as default};
